extends ../layout.pug

block content
  -
    const —ÅuttedAnnounces = popularArticles.map((article) => {
      return article.announce.length > 100
        ? `${article.announce.slice(0, 100)}...`
        : article.announce;
    });

    const —ÅuttedComments = lastComments.map((comment) => {
      return comment.text.length > 100
        ? `${comment.text.slice(0, 100)}...`
        : comment.text;
    });

    const foundUser = (userId) => allUsers.find((user) => user.id === userId);

  .wrapper
    include ../partials/header.pug
    if articles.length === 0
      main.main-page
        h1.visually-hidden –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–∏—á–Ω–æ–≥–æ –±–ª–æ–≥–∞ –¢–∏–ø–æ—Ç–µ–∫–∞
        p.main-page__greeting.title.title--big.
          
          –≠—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü –±–ª–æ–≥–∞ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å, —á—Ç–æ–±—ã –æ–ø–∏—Å–∞—Ç—å —Å–µ–±—è üëè
          
        .main-page__empty-wrapper
          p.main-page__empty-text –ó–¥–µ—Å—å –ø–æ–∫–∞ –ø—É—Å—Ç–æ!
    else
      main.main-page
        h1.visually-hidden –ì–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ª–∏—á–Ω–æ–≥–æ –±–ª–æ–≥–∞ –¢–∏–ø–æ—Ç–µ–∫–∞
        p.
          
          –≠—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–ª–∞–¥–µ–ª–µ—Ü –±–ª–æ–≥–∞ –º–æ–∂–µ—Ç –≤—ã–±—Ä–∞—Ç—å, —á—Ç–æ–±—ã –æ–ø–∏—Å–∞—Ç—å —Å–µ–±—è üëè
          
        section.main-page__theme-list
          h2.visually-hidden –°–ø–∏—Å–æ–∫ —Ç–µ–º
          ul.themes
            each category in categories
              li.themes__item
                a.themes__item-link(href='#')
                  | #{category.name}
                  sup #{category.sumOfEquals}
        .main-page__section-flex
          section.main-page__hot.hot
            h2.hot__name
              | –°–∞–º–æ–µ –æ–±—Å—É–∂–¥–∞–µ–º–æ–µ 
              span.hot__icon.hot__icon--fire
            if popularArticles.length === 0
              p.hot__empty –ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...
            else
              ul.hot__list
                each article, index in popularArticles
                  li.hot__list-item
                    a.hot__list-link(href=`/articles/${article.articleId}`)
                      | #{—ÅuttedAnnounces[index]}
                      sup #{article.sumOfComments}
          section.main-page__last.last
            h2.last__name
              | –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ 
              span.last__icon.last__icon--cloud
            if lastComments.length === 0
              p.last__empty –ó–¥–µ—Å—å –ø–æ–∫–∞ –Ω–∏—á–µ–≥–æ –Ω–µ—Ç...
            else
              ul.last__list
                each comment, index in lastComments
                  li.last__list-item
                    img.last__list-image(src=`img/${foundUser(comment.userId).userAvatar}` width='20' height='20' alt='–ê–≤–∞—Ç–∞—Ä –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è')
                    b.last__list-name #{foundUser(comment.userId).userName} #{foundUser(comment.userId).userSurname}
                    a.last__list-link(href=`/articles/${comment.articleId}`) #{—ÅuttedComments[index]}
        section.main-page__list.preview
          h2.visually-hidden –°–ø–∏—Å–æ–∫ –ø—Ä–µ–≤—å—é —Å—Ç–∞—Ç–µ–π
          ul.preview__list
            each article in articles
              li.preview__item
                ul.preview__breadcrumbs
                  each category in article.categories
                    li.preview__breadcrumbs-item
                      a.preview__breadcrumbs-link(href='#') #{category.name}
                .preview__background
                  img.preview__background-image(src=`img/${article.picture}` width='460' height='240' alt=article.title)
                time.preview__time(datetime=`${formatDate(dayjs, article.createdAt, `tagFormat`)}`) #{formatDate(dayjs, article.createdAt, `visualFormat`)}
                h3.preview__name
                  a.preview__name-link(href='#') #{article.title}
                p.preview__text #{article.fullText}
                a.preview__comment(href='#')
                  | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ 
                  span.preview__cloud
                  |  
                  b.preview__comment-count #{article.comments.length}
          +pagination(page, totalPages, 2, `?`)
    include ../partials/footer.pug