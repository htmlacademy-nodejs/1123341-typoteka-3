extends ../layout.pug

block content
  -
    const capacities = article.categories
      .map((category) => allNotes
        .filter((note) => note.category
          .includes(category)).length
      );

  .wrapper
    header.header
      a.header__logo.logo(href='#')
        img.logo__image(src='img/icons/logo-image-only.svg' alt='логотип Тайпотеки')
        span.logo__name Типотека
      nav.header__nav
        ul.header__nav-list
          li.header__list-item
            p Алёна Фролова
          li.header__list-item
            a.header__exit(href='#') Выйти
      a.header__avatar.avatar
        img(src='img/avatar-2.png' alt='аватар пользователя')
      a.header__search.button.button--search(href='#' aria-label='поиск по сайту')
    main
      section.post
        h1.visually-hidden Пост
        section.post__content
          h2.visually-hidden Основное содержание
          .post__wrapper
            .post__head
              a.post__backwards.button.button--backwards(href='#') Назад
              time.post__date(datetime=`${formatDate(article.createdAt)}`) #{formatDate(article.createdAt, false)}
              h2.post__title.title.title--main AirPods в один клик
              ul.post__themes.themes
                each category, index in article.categories
                  li.themes__item
                    a.themes__item-link(href='#')
                      | #{category.name}
                      sup #{capacities[index]}
                    button.themes__remove-btn(type='button') Удалить категорию
            .post__picture
              img(src=`img/${article.picture}@1x.jpg` alt=article.title)
            .post__text
              h3 #{article.title}
              p.
                #{article.fulltext}
                
              p #{article.fulltext}
        .post__wrapper.post__wrapper--comments
          section.post__comments.comments
            h2.comments__title.title.title--middle Комментарии
            ul.comments__list
              each comment in article.comments
                li.comments__comment
                  .comments__avatar.avatar
                    img(src='img/avatar-1.png' alt='аватар пользователя')
                  .comments__text
                    .comments__head
                      p Евгений Петров •
                      time.comments__date(datetime=`${formatDate(comment.createdAt, `tagFormat`)}`) #{formatDate(comment.createdAt, `visualFormat`)}
                    p.comments__message #{comment.text}
            .comments__footer.comments__footer--user
              form(action='#' method='POST')
                .comments__avatar.avatar
                  img(src='img/avatar-2.png' alt='аватар пользователя')
                label
                  textarea(rows='1' placeholder='Присоединиться к обсуждению')
                button.comments__button.button.button--colored(type='submit') Опубликовать
    include ../partials/footer.pug
